{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load exam_extras %}


{% block meta %}

<title>{{ meta.title|default:"Default Title" }}</title>
<meta name="description" content="{{ meta.description|default:'Default description' }}">
<meta name="keywords" content="{{ meta.keywords|default:'keyword1, keyword2' }}">

{% endblock %}
{% block css %}

    <!-- Google Fonts Link -->
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&amp;family=Rubik:ital,wght@0,300..900;1,300..900&amp;display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/bootstrap.min.css' %}"
    />

    <!-- Swiper Slider CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/swiper-bundle.min.css' %}"
    />

    <!-- Font Awesome CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/fontawesome.min.css' %}"
    />

    <!-- Wow Animation CSS Link -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/animate.css' %}" />

    <!-- Main Style CSS Link -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/style.css' %}" />

    <link rel="stylesheet" href="{% static 'assets/css/Bundle.css' %}" />
  </head>
{% endblock %}

{% block main %}
<!-- Banner Start -->
<section class="inner-banner">
  <div class="main-banner-bg-shape">
    <div class="shape-1"></div>
    <div class="shape-2"></div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="banner-content text-center">
          <h1 class="h1-title">{{ exam.title }}</h1>
          <div class="banner-breadcrum">
            <ul>
              <li><a href="{% url 'index' %}" title="Home">{% trans 'Ana səhifə' %}</a></li>
              <li><i class="fa-solid fa-angle-right"></i></li>
              <li>{{ exam.title }}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Banner End -->

<!-- Exams Start -->
<div class="sec-space single-exam">
  <div class="container">
    <div class="row">
      <div class="text-center mb-3">
        <a href="{% url 'exam_review' exam.id %}" class="sec-btn"> {% trans 'Rəy yaz' %} </a>
      </div>

      <div class="row col-lg-12">
        <!-- Əsas nəticə qutusu -->
        <div class="result-box">
          <h2>{% trans 'İmtahanın nəticəsi' %}</h2>

          <div class="info-row">
            <div class="label">{% trans 'İmtahan:' %}</div>
            <div class="value">{{ exam.title }}</div>
          </div>

          <div class="info-row">
            <div class="label">{% trans 'Ad, soyad:' %}</div>
            <div class="value">{{ session.user.get_full_name }}</div>
          </div>

          <div class="info-row">
            <div class="label">{% trans 'Başlama vaxtı:' %}</div>
            <div class="value">{{ session.started_at|date:"d F Y, H:i" }}</div>
          </div>

          <div class="info-row">
            <div class="label">{% trans 'Bitmə vaxtı:' %}</div>
            <div class="value">{{ session.finished_at|date:"d F Y, H:i" }}</div>
          </div>
        </div>

        <div class="result-box">
          <div class="info-row">
            <div class="label green">{% trans 'Sual sayı:' %}</div>
            <div class="value green">{{ total_questions }}</div>
          </div>

          <div class="info-row">
            <div class="label gray">{% trans 'Cavab verilməmiş:' %}</div>
            <div class="value gray">{{ unanswered_count }}</div>
          </div>

          <div class="info-row">
            <div class="label green">{% trans 'Doğru cavab sayı:' %}</div>
            <div class="value green">{{ correct_count }}</div>
          </div>

          <div class="info-row">
            <div class="label red">{% trans 'Yanlış cavab sayı:' %}</div>
            <div class="value red">{{ wrong_count }}</div>
          </div>

          <div class="info-row blue">
            <div class="label">{% trans 'Toplanmış bal:' %}</div>
            <div class="value blue">{{ final_points }}</div>
          </div>
        </div>
      </div>

      <!-- Suallar və cavablar -->
      {% for ans in answers %}
      <div class="result-question col-lg-6">
        <h3>
          {{ forloop.counter }}.
          {% if ans.question.image_quest %}
            <img src="{{ ans.question.image_quest.url }}" alt="Sual şəkli" />
          {% endif %}
          {{ ans.question.title_quest|safe }}
        </h3>

        <div class="result-answer {% if ans.is_correct %}correct{% else %}wrong{% endif %}">
          <span>{% trans 'Seçilmiş cavab:' %}</span>
          {% if ans.selected_option %}
            {% with opt=ans.selected_option %}

              {{ opt }} {% if ans.is_correct %}✅{% else %}❌{% endif %}
            {% endwith %}
          {% else %}
            <em>{% trans 'Cavab verilməyib' %}</em>
          {% endif %}
        </div>

        {% if not ans.is_correct and ans.selected_option %}
          <div class="true-result-answer">
            <strong>{% trans 'Doğru cavab:' %}</strong>
            {% if ans.question.correct_option %}
              {{ ans.question.correct_option }}
            {% else %}
              {% for letter in "ABCDEF" %}
                {% with field="is_correct_"|add:letter|lower %}
                  {% if ans.question|attr:field %}
                    {{ letter }}
                  {% endif %}
                {% endwith %}
              {% endfor %}
            {% endif %}
          </div>
        {% endif %}

        {% if ans.question.explanation %}
          <div class="note">
            <strong>{% trans 'İzahi:' %}</strong> {{ ans.question.explanation|safe }}
          </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>
<!-- Exams End -->
{% endblock %}

{% block js %}
  
    <!-- Back To Top Start -->
    <div class="scroll-to-top">
      <svg
        class="progress-circle svg-content"
        width="100%"
        height="100%"
        viewBox="-1 -1 102 102"
      >
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"></path>
      </svg>
    </div>
    <!-- Back To Top End -->

    <!-- Jquery JS Link -->

    <script src="{% static 'assets/js/jquery-3.7.1.min.js' %}"></script>

    <!-- Bootstrap JS Link -->
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>

    <!-- Swiper Slider JS Link -->
    <script src="{% static 'assets/js/swiper-bundle.min.js' %}"></script>

    <!-- Bg Moving JS Link -->
    <script src="{% static 'assets/js/bg-moving.js' %}"></script>

    <!-- Wow Animation JS Link -->
    <script src="{% static 'assets/js/wow.min.js' %}"></script>

    <!-- Custom JS Link -->
    <script src="{% static 'assets/js/custom.js' %}"></script>
    <script src="{% static 'assets/js/custom-scroll-count.js' %}"></script>

    <!-- Back To Top JS Link -->
    <script src="{% static 'assets/js/back-to-top.js' %}"></script>
{% endblock %}