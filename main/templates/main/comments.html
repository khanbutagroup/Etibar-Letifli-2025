{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load dict_filters %}

<!-- {% block meta %}

<title>{{ meta.title|default:"Default Title" }}</title>
<meta name="description" content="{{ meta.description|default:'Default description' }}">
<meta name="keywords" content="{{ meta.keywords|default:'keyword1, keyword2' }}">

{% endblock %} -->
{% block css %}

    <!-- Google Fonts Link -->
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&amp;family=Rubik:ital,wght@0,300..900;1,300..900&amp;display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/bootstrap.min.css' %}"
    />

    <!-- Swiper Slider CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/swiper-bundle.min.css' %}"
    />

    <!-- Font Awesome CSS Link -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'assets/css/fontawesome.min.css' %}"
    />

    <!-- Wow Animation CSS Link -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/animate.css' %}" />

    <!-- Main Style CSS Link -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/style.css' %}" />
  </head>
{% endblock %}

{% block main %}

<section class="inner-banner">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h1 class="h1-title">Rəylər — {{ exam.title }}</h1>
        <div class="banner-breadcrum">
          <ul>
            <li><a href="{% url 'index' %}">Ana səhifə</a></li>
            <li><i class="fa-solid fa-angle-right"></i></li>
            <li>Rəylər</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="contact-us-sec sec-space all-comments">
  <div class="container">
    <div class="header col-sm-7 text-center mx-auto ">
      <div class="rating">
        <div class="stars">
  {% for i in "12345" %}
    {% if forloop.counter <= avg_rating %}
      <span style="color: #4caf50;">★</span>
    {% elif forloop.counter <= avg_rating|add:"1" and avg_rating|floatformat:1|stringformat:"s"|slice:":3"|add:""|floatformat:1|stringformat:"s"|slice:"-1" == "5" %}
      <span style="color: #8bc34a;">★</span>
    {% else %}
      <span style="color: #ccc;">☆</span>
    {% endif %}
  {% endfor %}

        </div>
        <h1>{{ avg_rating|default:"0.0" }}</h1>
        <p>{{ total_reviews }} nəfər</p>
      </div>

      <div class="bars">
        {% for i in "54321" %}
          {% with star=i|stringformat:"i" %}
            {% with count=rating_distribution|default_if_none:0 %}
            {% endwith %}
            {% if total_reviews > 0 %}
              {% widthratio rating_distribution|default_if_none:0 total_reviews 100 as percent %}
            {% else %}
              {% with percent=0 %}
              {% endwith %}
            {% endif %}
            <div class="bar">
              <label>{{ i }}</label>
              <div class="bar-line">
                {% with count=rating_distribution|get_item:i %}
                  {% widthratio count total_reviews 100 as percent %}
                  <div class="bar-fill" 
                    style="width: {{ percent }}%; background:
                      {% if i == '5' %}#4caf50
                      {% elif i == '4' %}#8bc34a
                      {% elif i == '3' %}#fbc02d
                      {% elif i == '2' %}#ff9800
                      {% else %}#f44336{% endif %};
                    ">
                  </div>
                {% endwith %}
              </div>
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    </div>

    <div class="reviews">
      {% if comments %}
        {% for review in comments %}
          <div class="review">
            <h3>{{ review.user.get_full_name|default:review.user.username }}</h3>
            <div class="meta">
              <div class="stars">
  {% for i in "12345" %}
    {% if forloop.counter <= review.rating|add:"0" %}
      <span style="color: #4caf50;">★</span>
    {% else %}
      <span style="color: #ccc;">☆</span>
    {% endif %}
  {% endfor %}
              </div>
              <span>{{ review.created_at|timesince }} əvvəl</span>
            </div>
            <p>{{ review.comment }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Bu imtahan üçün hələ rəy yoxdur.</p>
      {% endif %}
    </div>
  </div>
</section>

{% endblock %}

{% block js %}
    <!-- Back To Top Start -->
  <div class="scroll-to-top">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
      <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"></path>
    </svg>
  </div>
    <!-- Back To Top End -->

    <!-- Jquery JS Link -->

    <script src="{% static 'assets/js/jquery-3.7.1.min.js' %}"></script>

    <!-- Bootstrap JS Link -->
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>

    <!-- Swiper Slider JS Link -->
    <script src="{% static 'assets/js/swiper-bundle.min.js' %}"></script>

    <!-- Bg Moving JS Link -->
    <script src="{% static 'assets/js/bg-moving.js' %}"></script>

    <!-- Wow Animation JS Link -->
    <script src="{% static 'assets/js/wow.min.js' %}"></script>

    <!-- Custom JS Link -->
    <script src="{% static 'assets/js/custom.js' %}"></script>

    <!-- Back To Top JS Link -->
    <script src="{% static 'assets/js/back-to-top.js' %}"></script>
{% endblock %}
